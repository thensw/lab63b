# การทดลองที่ 1 เรื่อง การเขียนโปรแกรมเพื่อรันบนไมโครคอนโทรเลอร์
## วัตถุประสงค์
1. เพื่อให้ทราบข้อมูลพื้นฐานเกี่ยวกับmicrocontrollerที่เลือกใช้(บริษัทผู้ผลิต/ชื่อบอร์ด/วิธีการเขียนโปรแกรม/พอร์ทที่ใช้ติดต่อ)
2. เพื่อศึกษาวิธีการอัปโหลดโปรแกรมลงไมโครคอนโทรลเลอร์
3. เพื่อศึกษาวิธีเขียนโปรแกรมโดยใช้คำสั่งต่างๆบนคอมพิวเตอร์

## อุปกรณ์ที่ใช้
1. ไมโครคอนโทรลเลอร์ (ESP01)
2. สายUSB
3. programmer adapter usb to serial

## ศึกษาข้อมูลเบื้องต้น
คลิปตัวอย่างการทดลอง https://www.youtube.com/watch?v=NLIUsWLEpmg
## วิธีการทำการทดลอง
1. เขียนโปรแกรมลงบนไมโครคอนโทรลเลอร์ จากนั้นต่อไมโครคอนโทรลเลอร์เข้ากับserial port บนตัวadapter programmer ที่ต่อกับสายUSBไว้เรียบร้อยแล้ว

![1](https://user-images.githubusercontent.com/80879818/112277591-7fbc9780-8cb4-11eb-8f58-9c6f01d03fe1.jpg)

2. เปิดโปรแกรมตัวอย่างที่ต้องการจะอัปโหลดลงไมโครคอนโทรลเลอร์
* พิมพ์ cd ตามด้วยชื่อโฟลเดอร์ที่ต้องการเปิด
* ภายในโฟลเดอร์จะมีโปรแกรมตัวอย่างอยู่ 9 โปรแกรม (ดังภาพ)

![1](https://user-images.githubusercontent.com/80879818/112281393-949b2a00-8cb8-11eb-90c3-45d8426392c2.jpg)

* เลือกโปรแกรมตัวอย่างที่ต้องการอัปโหลด (ในที่นี้จะเลือกโปรแกรมที่1)
  * พิมพ์ cd 01_Serial-Monitor
  * พิมพ์ vi src/main.cpp (เพื่อแสดงโค้ดที่ใช้เขียนโปรแกรมที่เลือกไว้)
 ```javascript
 #include <Arduino.h>

 int cnt = 0;

 void setup()
{
	Serial.begin(115200);
}

void loop()
{
	cnt++;
	Serial.printf("PATTANI :%d\n",cnt);
	delay(1000);
}
```
> จากโค้ดเบื้องต้น มีทั้งหมด15บรรทัด โดยแบ่งเป็น 2 ส่วน คือ 
> * set up จะถูกทำแค่ครั้งเดียว โดยจะ set up serial port ด้วยความเร็ว 115200
> * loop จะถูกซ้ำไม่มีวันจบ 
>    * คำสั่ง cnt++ เป็นการนับตัวแปรเพิ่มขึ้นเรื่อยๆ
>    * คำสั่ง Serial.printf("PATTANI :%d\n",cnt) เป็นการแสดงผลในการนับจากคำสั่งก่อนหน้า โดยในที่นี้ตัวแปร = PATTANI
>    * คำสั่ง delay(1000) เป็นความหน่วงเวลา 1000 ms หรือ 1 วินาที
3. แสดงข้อมูลพื้นฐานของไมโครคอนโทรลเลอร์จาก configuration file ภายในโปรแกรม
* พิมพ์ vi platformio.ini

![2](https://user-images.githubusercontent.com/80879818/112285060-7afbe180-8cbc-11eb-9ef0-271e8c813015.jpg)

4. อัปโหลดโปรแกรมลงไมโครคอนโทรลเลอร์
* พิมพ์ pio run -t upload
> ในขณะที่โปรแกรมกำลังอัปโหลด `กดปุ่มสีดำบนตัวadapter` เพื่อให้ตัวไมโครคอนโทรลเลอร์รับโปรแกรมใหม่เข้าไป
> จากนั้น `กดปุ่มสีแดงบนตัวadapter` เพื่อทำการรีเซต
5. แสดงผลลัพธ์จากโปรแกรมบนคอมพิวเตอร์
* พิมพ์ pio device monitor 
> หากต้องการรีเซตผลลัพธ์ใหม่ตั้งแต่ต้นให้`กดปุ่มสีแดงบนตัวadapter`1 ครั้ง

![3](https://user-images.githubusercontent.com/80879818/112287321-d4651000-8cbe-11eb-9983-0973b82d1822.jpg)

## การบันทึกผลการทดลอง
คำสั่งที่ถูกใช้ในการทดลอง มีดังนี้
1. src/main.cpp คือ โค้ดของโปรแกรมที่เลือก โดยจะแบ่งเป็น2ส่วน คือ set up , loop
2. platformio.ini คือ ข้อมูลใน configuration file
3. pio run -t upload คือ คำสั่งอัปโหลดโปรแกรมลงไมโครคอนโทรลเลอร์
4. pio device monitor คือ การแสดงผลจากโปรแกรมตัวอย่าง ในที่นี้คือตัวแปรถูกนับเพิ่มขึ้นในทุกๆ 1 วินาที
5. ปุ่มสีดำ(บนadapter) คือ การโหลดโปรแกรม
6. ปุ่มสีแดง(บนadapter) คือ การรีเซตโปรแกรม
## อภิปรายผลการทดลอง
ในการทดลองนี้ใช้platformioในการเขียนโปรแกรม โดยจะใช้คำสั่ง platformio.ini ในการแสดงข้อมูลพื้นฐานของไมโครคอนโทรลเลอร์ ในส่วนของการอัปโหลดโปรแกรมลงไมโครคอนโทรลเลอร์นั้นจะใช้คำสั่ง pio run -t upload ซึ่งคำสั่งเหล่านี้สามารถใช้กับไมโครคอนโทรลเลอร์ได้ทุกชนิด/ทุกแบบ
## คำถามหลังการทดลอง
ถ้าหากในตอนท้ายของการทดลองไม่กดปุ่มสีแดงบนadapter จะเกิดผลลัพธ์แบบใด

Ans. ตัวแปรจะถูกนับเพิ่มขึ้นไปเรื่อยๆจนกว่าจะมีการหยุดหรือออกจากโปรแกรม

# การทดลองที่ 3 เรื่อง การเขียนโปรแกรมเอ้าพุทสัญญาณดิจิทัล
## วัตถุประสงค์
1. เพื่อศึกษาการทำงานของrelay
2. เพื่อศึกษาวิธีการใช้อุปกรณ์ต่างๆ
3. เพื่อศึกษาวิธีการเขียน/อ่านค่าของโปรแกรมที่ใช้ในการทดลอง
## อุปกรณ์ที่ใช้
1. ไมโครคอนโทรลเลอร์ (ESP01)
2. สายUSB
3. programmer / usb to serial
4. adapter
5. หลอดไฟLEDเปล่งแสง
6. relay
## ศึกษาข้อมูลเบื้องต้น
คลิปตัวอย่างการทดลอง 
* https://www.youtube.com/watch?v=CCnN1WJsXQY
* https://www.youtube.com/watch?v=6JnhaUILGuw
## วิธีการทำการทดลอง
1. ต่อadapterเข้ากับพอร์ท0(สายสีขาว),1(สายสีเหลือง) และนำพอร์ทต่อเข้ากับหลอดLEDเปล่งแสง (เพื่อดูผลลัพธ์จากการทดลอง)

![4](https://user-images.githubusercontent.com/80879818/112313689-b4dbe080-8cda-11eb-87ca-6766a18c049f.jpg)


2. ต่อไมโครคอนโทรลเลอร์ผ่านadapterเข้าไปที่ตัวusb to serial

![5](https://user-images.githubusercontent.com/80879818/112314208-56633200-8cdb-11eb-93c1-f1e51f3d3936.jpg)

3. เปิดโปรแกรมตัวอย่าง (ในที่นี้เลือกโปรแกรมที่3)
* พิมพ์ cd pattani (ชื่อโฟลเดอร์ที่จะเปิด)
* พิมพ์ cd 03_Output-Port
* พิมพ์ vi src/main.cpp (เพื่อแสดงเนื้อหาโปรแกรม)
```javascript
#include <Arduino.h>
#include <ESP8266WiFi.h>

int cnt = 0;

void setup()
{
	Serial.begin(115200);
	pinMode(0, OUTPUT);
	Serial.println("\n\n\n");
}

void loop()
{
	cnt++;
	if(cnt % 2) {
		Serial.println("========== ON ===========");
		digitalWrite(0, HIGH);
	} else {
		Serial.println("========== OFF ===========");
		digitalWrite(0, LOW);
	}
	delay(500);
}
```
> จากโค้ดเบื้องต้น
> * บรรทัดที่ 9 'pinMode(0, OUTPUT)' เป็นการเซตให้พอร์ท0เป็นพอร์ทOUTPUT
> * cnt++ เป็นการนับเพิ่มขึ้นไปเรื่อยๆ 
>   * ถ้า'cntเป็นเลขคี่ (cnt%2)'ให้ทำการ ON
>   * นอกเหนือจากนี้ คือ 'cntเป็นเลขคู่' ให้ทำการ OFF
> * delay(500) เป็นคำสั่งให้วนลูปทุกครึ่งวินาที หรือ 500 ms
4. อัปโหลดโปรแกรมเข้าสู่ไมโครคอนโทรลเลอร์
* พิมพ์ pio run -t upload
	* ในขณะที่โปรแกรมกำลังอัปโหลด `กดปุ่มสีดำบนตัวprogrammer` เพื่อให้ตัวไมโครคอนโทรลเลอร์รับโปรแกรมใหม่เข้าไป
	* จากนั้น `กดปุ่มสีแดงบนตัวprogrammer` เพื่อทำการรีเซต

![6](https://user-images.githubusercontent.com/80879818/112324689-a0e9ac00-8ce5-11eb-8271-047e9967333e.jpg)

5. แสดงผลลัพธ์จากโปรแกรมผ่านคอมพิวเตอร์
* พิมพ์ pio device monitor

![8](https://user-images.githubusercontent.com/80879818/112325198-0fc70500-8ce6-11eb-94f4-dceb2795eaaa.jpg)

![9](https://user-images.githubusercontent.com/80879818/112326829-739dfd80-8ce7-11eb-909d-d92354b642c8.jpg)

### ในกรณีที่นำrelayเพิ่มเข้ามาใช้เป็นสวิตซ์ปิด-เปิด
6. เปลี่ยนให้ไมโครคอนโทรลเลอร์มาต่อเข้ากับตัวrelay 

![10](https://user-images.githubusercontent.com/80879818/112331270-59feb500-8ceb-11eb-9a35-df8bfa024abf.jpg)

7. ถอดสายUSB(ไฟเลี้ยง)ออกจากตัวprogrammerมาต่อเข้ากับrelayแทน เพื่อจ่ายไฟให้relayทำงาน

![25](https://user-images.githubusercontent.com/80879818/112331965-f1640800-8ceb-11eb-81dc-b78661f2417b.jpg)

```javascript
สัญญาณON คือ เปิดสวิตซ์
สัญญาณOFF คือ ปิดสวิตซ์
```
## การบันทึกผลการทดลอง
count | สีของหลอดไฟ | ความสว่าง
----- | ----------- | -------
เลขคี่ | ไฟสีเขียว | ติด
เลขคู่ | ไฟสีเขียว | ดับ
> สังเกตได้ว่าการทดลองนี้มีการปล่อยOUTPUTไปที่พอร์ท0(ต่อกับไฟสีเขียว) ดังนั้นไฟสีเขียวจึงติดๆดับๆตามการวนลูปของโปรแกรม แต่หลอดไฟสีน้ำเงินต่อเข้ากับพอร์ท1 ซึ่งไม่ได้ส่งสัญญาณOUTPUTไปที่พอร์ทนั้น ไฟจึงไม่ติดเลย

`หลังจากที่ใช้relayเป็นสวิตซ์เปิด-ปิด`

![26](https://user-images.githubusercontent.com/80879818/112334036-b236b680-8ced-11eb-93a7-01ed68d90c2f.jpg)

* พบว่าโปรแกรมบนไมโครคอนโทรลเลอร์จะเป็นตัวบังคับrelayให้วนลูปการเปิด-ปิด ซึ่งจะมีไฟติดๆดับๆเช่นกัน
> เพิ่มเติม : เสียงที่ได้ยินหลังจากrelayทำงานนั้น คือ เสียงของหน้าสัมผัสของสวิตซ์ไฟซึ่งเป็นโลหะที่เอาไว้ใช้ในเป็นตัวนำไฟฟ้าให้ทำงานในการเปิด-ปิดสวิตซ์
## อภิปรายผลการทดลอง
ในการทดลองครั้งนี้มีการต่อสัญญาณOUTPUTไปที่พอร์ท0(สายสีขาว) หลอดไฟที่ต่อเข้ากับพอร์ทนี้จึงสามารถใช้แสดงผลในการรันโปรแกรมจากไมโครคอนโทรลเลอร์ได้ และเมื่อมีการต่อrelayเพิ่มเข้ามาเพื่อใช้ทำหน้าที่เป็นสวิตซ์เปิด-ปิด จะต้องมีการย้ายตัวไมโครคอนโทรลเลอร์และไฟเลี้ยงมาต่อเข้ากับตัวrelayแทนUSB to serial เพื่อให้ตัวrelayทำงานได้อย่างสมบูรณ์ โดยสามารถสังเกตผลการทดลองได้จากไฟบนตัวrelayได้เลย ซึ่งให้ผลลัพธ์สอดคล้องกับโปรแกรมที่ลงไว้ในไมโครคอนโทรลเลอร์
## คำถามหลังการทดลอง
ถ้าไม่ได้ต่อไฟเลี้ยงเข้าไปที่relay จะสามารถแสดงผลการรันโปรแกรมที่หลอดไฟLEDได้ปกติไหม

Ans. ไม่ เนื่องจากตัวrelayไม่มีไฟในตัวเอง จึงต้องอาศัยการต่อไฟเลี้ยงเพื่อให้เกิดการทำงานที่สมบูรณ์

# การทดลองที่ 7 เรื่อง การใช้สัญญาณอินพุทในการควบคุมการเชื่อมต่อสัญญาณwifi โดยสังเกตการทำงานจากหลอดไฟLED
## วัตถุประสงค์
1. เพื่อคิดค้นโปรแกรมใหม่ๆโดยผสมผสานระหว่างความคิดสร้างสรรค์กับความรู้พื้นฐานจากแลปครั้งก่อน
2. เพื่อศึกษาวิธีการเขียนโปรแกรมที่ถูกต้อง
3. เพื่อศึกษาการแสดงผลของINPUTต่างๆในรูปแบบของการเชื่อมต่อสัญญาณwifi
## อุปกรณ์ที่ใช้
1. ไมโครคอนโทรลเลอร์ (ESP01)
2. สายUSB(ไฟเลี้ยง)
3. programmer / usb to serial
4. adapter
5. หลอดไฟLEDเปล่งแสง
6. เร้าเตอร์ปล่อยสัญญาณwifi
## ศึกษาข้อมูลเบื้องต้น
1. คลิปตัวอย่างการทดลองที่4และ5
* (4) https://www.youtube.com/watch?v=nFqoZT26U5k
* (5) https://www.youtube.com/watch?v=VX-QNQcO-b4
2. ตัวอย่างการเขียนโปรแกรมจาก https://github.com/choompol-boonmee/lab63b/tree/master/examples
3. ความรู้เพิ่มเติมจากอินเทอร์เน็ต
## วิธีการทำการทดลอง
1. ทำการต่อไฟเลี้ยงเข้าที่ตัวprogrammer และต่อไมโครคอนโทรลเลอร์ผ่านตัวadapterเข้าไปยังprogrammer (ดังภาพ)

![33](https://user-images.githubusercontent.com/80879818/112346747-d51a9800-8cf8-11eb-824c-b69084d3c0ad.jpg)

2. เปิดตัวอย่างโปรแกรม
* พิมพ์ vi src/main.cpp (เพื่อแสดงเนื้อหาโปรแกรม)
```javascript
#include <Arduino.h>
#include <ESP8266WiFi.h>
//#include <WiFiClient.h>
#include <ESP8266WebServer.h>

const char* ssid = "supreeya.4G";
const char* password = "0830611575";

ESP8266WebServer server(80);

int d = 1000//5;
int cnt = 0;

void setup(void)
{
 Serial.begin(115200);
 pinMode(0, INPUT);
 pinMode(2, OUTPUT);
 Serial.println("\n\n\n");
 Serial.begin(115200);
	WiFi.mode(WIFI_STA);
	WiFi.begin(ssid, password);
	while (WiFi.status() != WL_CONNECTED) {
		delay(5*100);
		Serial.print(".");
	}
	Serial.print("\n\nIP address: ");
	Serial.println(WiFi.localIP());

	server.onNotFound([]() {
		server.send(404, "text/plain", "Path Not Found");
	});

	server.on("/", []() {
		String msg = "Hello";
		server.send(200, "text/plain");
	});

	server.begin();
	Serial.println("HTTP server started");
}
void loop()
{
 server.handleClient();
 int val = digitalRead(0);
 Serial.printf("======= read %d\n", val);
 if(val==1) {
  digitalWrite(2, LOW);
 } else {
  digitalWrite(2, HIGH);
 }
delay(d);
}
```
> จากโค้ดเบื้องต้น แบ่งข้อมูลเป็น2ส่วน ดังนี้
> * set up
>   * เซตให้พอร์ท0(สายสีขาว) คือ INPUT
>   * เซตให้พอร์ท2(สายสีเหลือง) คือ OUTPUT
>   * เป็นการเชื่อมต่อกับwifiที่เลือกไว้
>   * set up web server
>   	* เริ่มต้นด้วย 'Hello'
> * loop
>   * `int val = digitalRead(0)` เป็นการอ่านข้อมูลINPUTจากพอร์ท0 ซึ่งเป็นข้อมูลดิจิตอล(0,1)
>   * ถ้าINPUT=1 , ไฟจะดับ = ไม่ได้เชื่อมต่อกับสัญญาณwifi
>   * ถ้าINPUT=0 , ไฟจะติด = เริ่มการเชื่อมต่อwifiที่เลือกไว้
>   * delay(d) เป็นคำสั่งให้วนลูปทุกๆ 1000//5 = 200 ms
3. อัปโหลดโปรแกรมเข้าสู่ไมโครคอนโทรลเลอร์
* พิมพ์ pio run -t upload
  * ในขณะที่โปรแกรมกำลังอัปโหลด `กดปุ่มสีดำบนตัวprogrammer` เพื่อให้ตัวไมโครคอนโทรลเลอร์รับโปรแกรมใหม่เข้าไป
  * จากนั้น `กดปุ่มสีแดงบนตัวprogrammer` เพื่อทำการรีเซต
  * เมื่อโปรแกรมถูกอัปโหลดเสร็จสิ้นแล้ว จะทำการตรวจสอบที่พอร์ท0ทันทีเลยว่ามีINPUTเข้ามาหรือไม่
4. แสดงผลลัพธ์จากโปรแกรมผ่านคอมพิวเตอร์
* พิมพ์ pio device monitor
* กดปุ่ม reset เพื่อเริ่มการทำงานใหม่ โดยจะเริ่มจากการค้นหาwifi , เชื่อมต่อwifi และแสดงผลip address
## การบันทึกผลการทดลอง
* สัญญาณINPUTจากพอร์ท0จะเป็นตัวควบคุมให้ไฟติด/ดับ ซึ่งจะเป็นสัญลักษณ์บอกว่าโปรแกรมเริ่มการเชื่อมต่อwifiแล้วหรือยัง

ค่าINPUT | ความสว่าง | การเชื่อมต่อสัญญาณwifi
------- | ------- | -------
0 | ไฟติด | เริ่มเชื่อมต่อwifiแล้ว
1 | ไฟดับ | ยังไม่ได้เชื่อต่อwifi
## อภิปรายผลการทดลอง
การทดลองนี้เป็นการทดสอบการแสดงผลของINPUTที่รับมาผ่านหลอดไฟLEDเปล่งแสง โดยสามารถใช้สังเกตการทำงานของโปรแกรมในการเชื่อมต่อwifiได้ ซึ่งเป็นการทดลองที่ไม่ได้เกิดขึ้นจริง เป็นเพียงสมมติฐานของผู้เรียนเท่านั้น โดยที่ผู้เรียนสังเกตจากการทำงานของเร้าเตอร์wifi ซึ่งจะมีไฟติดเมื่อได้รับสัญญาณINPUTเป็นการกดเปิดเร้าเตอร์ ดังนั้นการเขียนโปรแกรมหรือผลลัพธ์จากการทดลองในภาคปฏิบัติจริงอาจไม่เป็นไปตามที่บันทึกผลไว้ณ ที่นี้ 
## ประโยชน์จากการทดลอง
1. อาจนำไปใช้พัฒนาเร้าเตอร์wifiให้สามารถรับสัญญาณINPUTในแบบอื่นๆเพิ่มมากขึ้นได้ เช่น สามารถสั่งงานผ่านโทรศัพท์มือถือได้
## คำถามหลังการทดลอง
สามารถใช้ไมโครคอนโทรลเลอร์ตัวอื่นๆในการรับโปรแกรมตัวนี้ได้หรือไม่?

Ans. ได้ จากที่ศึกษาข้อมูลมา มีไมโครคอนโทรลเลอร์ที่ได้รับความนิยมในการนำมาประยุกต์ใช้เพื่อเพิ่มความสะดวกสบายให้มากขึ้นในการใช้งานอุปกรณ์ไฟฟ้า นั่นคือ ESP8266
